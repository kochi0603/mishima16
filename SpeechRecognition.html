<!DOCTYPE html>
<html>

<head lang="ja-JP">
<meta charset="utf-8">
<title>Speak Test</title>
<script type="text/javascript" 
        src="jquery-3.5.1.js"></script>
<script type="text/javascript">
<!--
        $(document).ready(function(){
                // Chrome と Firefox 両方に対応するための書き方
                const SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
                const rec = new SpeechRecognition();

                rec.continuous = true; // 継続して音声認識を行う
                rec.interimResults = false;　// 変換途中の結果を受け取りたいときtrueにする。変換途中の場合、isFinalはfalseとなっている
                rec.lang = "ja-JP" // "en-US"

                rec.addEventListener('start', function() {
                        $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "開始" );
                        $('#LOGAREA').css('background-color', 'silver');
                });

                rec.addEventListener('end', function() {
                        $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "終了" );
                        $('#LOGAREA').css('background-color', 'white');
                });

                rec.addEventListener('audiostart', function() {
                        $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "準備OK" );
                });

                rec.addEventListener('result', function(e) {
                        if( e.results.length ) {
                                for ( let ia = e.resultIndex; ia < e.results.length; ia++) {
                                        if( e.results[ia].isFinal ) {
                                                $("#LOGAREA").val( $("#LOGAREA").val() + "\nRESULTS LENGTH=\t" + e.results.length );
                                                $("#LOGAREA").val( $("#LOGAREA").val() + "\nRESULTS INDEX=\t" + e.resultIndex );
                                                //$('#LOGAREA').val( 'fixed!!\n' + results[0].transcript );
                                                $("#LOGAREA").val( $("#LOGAREA").val() + "\n認識結果=\t" + e.results[ia][0].transcript );

                                                if ( e.results[ia][0].transcript == '変換' ){
                                                        $('#LOGAREA').css('background-color', 'blue');
                                                }
                                        }
                                }
                        }
                });

                $("#START_BTN").on( 'click', function() {
                        rec.start();
                } );

                $("#STOP_BTN").on( 'click', function() {
                        rec.stop();
                } );
        });
//-->
</script>
</head>
<body>
    <button id="START_BTN">start</button>
    <button id="STOP_BTN">stop</button>
    <br>
    <textarea id="LOGAREA" rows=30 cols=80></textarea>
</body>
</html>
