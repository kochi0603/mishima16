<!DOCTYPE html>
<html>

<head lang="ja-JP">
<meta charset="utf-8">
<title>Speak Test</title>
<script type="text/javascript" 
        src="jquery-3.5.1.js"></script>
<script type="text/javascript">
<!--
        $(document).ready(function(){
                const SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;
                const rec = new SpeechRecognition();

                rec.continuous = true;
                rec.interimResults = false;
                rec.interimResults = true;
                rec.lang = "ja-JP" // "en-US"
                rec.maxAlternatives = 3;

                rec.addEventListener('start', function() {
                        $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "start" );
                        $('#LOGAREA').css('background-color', 'red');
                });
                rec.addEventListener('end', function() {
                        $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "stop" );
                        $('#LOGAREA').css('background-color', 'white');
                });

                //rec.addEventListener('audiostart', (e) => console.log('audiostart', e));  
                //rec.addEventListener('soundstart', (e) => console.log('soundstart', e));  
                //rec.addEventListener('speechstart', (e) => console.log('speechstart', e));  
                //rec.addEventListener('speechend', (e) => console.log('speechend', e));  
                //xrec.addEventListener('soundend', (e) => console.log('soundend', e));  
                // rec.addEventListener('audioend', (e) => console.log('audioend', e));  

                rec.addEventListener('result', function(e) {
                        if( e.results.length ) {
                                let results = e.results[0];
                                if( results.isFinal ) {
                                        //$('#LOGAREA').val( 'fixed!!\n' + results[0].transcript );
                                        $("#LOGAREA").val( $("#LOGAREA").val() + "\nFINISHED\n" + results[0].transcript );
                                } else {
                                        let possiblity = [].slice.call( results ).map( function( result, ia ) { return ia + ':' + result.transcript; } ).join('\n\n');
                                        //$('#LOGAREA').val( 'progress(' + results.length + ')...\n' + possiblity );
                                        $("#LOGAREA").val( $("#LOGAREA").val() + "\nPROGRESS\n" + possiblity );
                                }
                        } else {
                                $("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "結果が空です" );
                        }

                });

                $("#START_BTN").on( 'click', function() {
                        //console.log("start");
                        //$("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "start" );
                        rec.start();
                } );

                $("#STOP_BTN").on( 'click', function() {
                        //console.log("stop");
                        //$("#LOGAREA").val( $("#LOGAREA").val() + "\n" + "stop" );
                        rec.stop();
                } );
        });
//-->
</script>
</head>
<body>
    <button id="START_BTN">start</button>
    <button id="STOP_BTN">stop</button>
    <br>
    <textarea id="LOGAREA" rows=30 cols=80></textarea>
</body>
</html>
